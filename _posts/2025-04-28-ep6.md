---
title: 'Case Study - CVE-2024-47177 - Code Review Part 1'
date: 2025-04-28
permalink: /posts/2025/04/cve-2024-47177-part-1/
tags:
  - Case Study
  - CVE
  - Code Review
excerpt: "Starting the code review into CVE-2024-47177"
---



## Time Tally

- Time spent on topic: `4 hours`
- Total time spent on series: `20 hours`

---

Good day hackers! 

In my last blog, we were learning about the UDP protocol and related Nmap scans. 

I thought it would be fun to look up any high-impact, preferably recent CVEs that are discovered via UDP ports.

And I found [CVE-2024-47177](https://www.tenable.com/cve/CVE-2024-47177)!

Evilsocket did [a very detailed blog](https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/) post on this vulnerability. It is a great opportunity for our first vulnerability analysis follow-along.  

Without further ado, let's get to it!

## Let's take a look at the code

The goal of reviewing code for vulnerabilities is usually to look for **user inputs** for **high impact functionalities**, and examine whether that input is handled securely. 

With that in mind, onward we go.

---

I have always dreamed of finding my own zero-day, which means I need to be able to read, understand, and analyze complex code (even if it's C). So I'm taking this chance to practice.

At first glance of the [cups-browsed](https://github.com/OpenPrinting/cups-browsed/tree/2.0.1) repo, I look for a `main` function or an equivalent entry point of the program. This is found in `daemon/cups-browsed.c`.

*Note: I selected the 2.0.1 version of the repo, which is the last version that was vulnerable to RCE.*

Next, I skim through the comments to locate code of interest (CoI). 

"Initialization" ... "Read commandline options" ... "Help" ... "Read `cups-browsed.conf`" ... "`SIGINT` and `SIGTERM` handling" ... "set up CUPS browsing socket" ... 

"Run the main loop". Bingo!

With the main loop created with `g_main_loop_new (NULL, FALSE)` [here](https://github.com/OpenPrinting/cups-browsed/blob/2.0.1/daemon/cups-browsed.c#L14052) , it looks like we're watching for incoming browsing data with `process_browse_data` at [line 14059](https://github.com/OpenPrinting/cups-browsed/blob/2.0.1/daemon/cups-browsed.c#L14059), using `g_io_add_watch`.

The definition for `process_browse_data` can be found at [Line 11795](https://github.com/OpenPrinting/cups-browsed/blob/2.0.1/daemon/cups-browsed.c#L11795)

It seems to be performing some checks on the packet received by `cups-browsed`, and then calling another function `found_cups_printer`.

These checks might be important, because they define what would be considered a legit printer.

We will look deeper into the code tomorrow!

